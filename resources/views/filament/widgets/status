<style>
    .notificacao {
        position: absolute;
        top: -4px;
        right: -4px;
        height: 10px;
        width: 10px;
        background-color: #dc2626;
        border-radius: 9999px;
        z-index: 10;
    }

    .notificacao::after {
        content: '';
        position: absolute;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        border-radius: 9999px;
        background-color: #dc2626;
        opacity: 0.6;
        animation: pulse 1.2s infinite ease-in-out;
        z-index: -1;
    }

    @keyframes pulse {
        0% {
            transform: scale(1);
            opacity: 0.6;
        }

        70% {
            transform: scale(2.5);
            opacity: 0;
        }

        100% {
            transform: scale(1);
            opacity: 0;
        }
    }

    .status-badge {
        display: block;
        padding: 0.5rem 0.75rem;
        border-radius: 0.5rem;
        color: white;
        max-width: 100%;
        white-space: normal;
        line-height: 1.3;
        overflow: hidden;
        font-weight: 500;
        font-size: 0.75rem;
    }

    .status-title {
        font-weight: 700;
        font-size: 0.875rem;
    }

    .status-info {
        font-size: 9px;
    }

    .badge-aprovado {
        background-color: #059669;
    }

    .badge-pendente {
        background-color: #ca8a04;
    }

    .badge-rejeitado {
        background-color: #dc2626;
    }
</style>

<div class="w-full overflow-x-auto rounded-lg border border-gray-300 dark:border-gray-700">
    <table class="min-w-[800px] w-full table-fixed border-collapse text-center text-sm">
        <thead>
            <tr class="bg-gray-100 dark:bg-gray-800">
                <th class="px-4 py-2 bg-gray-200 dark:bg-gray-700 text-gray-900 dark:text-gray-100 sticky left-0 z-10">
                    Horário
                </th>
                @foreach ($weekdays as $dayId => $dayName)
                <th class="px-4 py-2 bg-gray-200 dark:bg-gray-700 text-gray-900 dark:text-gray-100 whitespace-nowrap">
                    {{ $dayName }}
                </th>
                @endforeach
            </tr>
        </thead>
        <tbody>
            @foreach ($timePeriods as $timePeriod)
            <tr>
                <td class="px-4 py-3 font-semibold bg-gray-50 dark:bg-gray-800 text-gray-900 dark:text-gray-100 sticky left-0 z-10 whitespace-nowrap">
                    {{ $timePeriod->description }}
                </td>
                @foreach ($weekdays as $dayId => $dayName)
                @php
                $schedule = $calendar[$timePeriod->id][$dayId] ?? null;

                $badgeClass = match($schedule->status ?? '') {
                'Aprovado' => 'badge-aprovado',
                'Pendente' => 'badge-pendente',
                'Rejeitado' => 'badge-rejeitado',
                default => '',
                };

                $info = [];
                if ($schedule) {
                $info[] = 'Sala: ' . ($schedule->room->name ?? '—');

                if (!empty($schedule->classes)) {
                $turmas = collect($schedule->classes)->pluck('class')->join(', ');
                $info[] = $turmas;
                }

                if (!empty($schedule->turno)) {
                $info[] = 'Turno: ' . $schedule->turno;
                }


                }
                @endphp

                <td class="px-4 py-3 align-top text-gray-900 dark:text-gray-100 border-t border-gray-200 dark:border-gray-700">
                    @if ($schedule)
                    @php
                    $firstRequest = $schedule->requests()->first();
                    @endphp

                    <a href="{{ $firstRequest
    ? route('filament.admin.resources.schedule-requests.edit', $firstRequest->id)
    : route('filament.admin.resources.schedules.edit', $schedule->id) }}">
                        <div class="relative">
                            <div class="status-badge {{ $badgeClass }}">
                                <div class="status-title">{{ $schedule->subject->subject ?? 'Sem Matéria' }}</div>
                                @foreach ($info as $i)
                                <div class="status-info">{{ $i }}</div>
                                @endforeach
                            </div>
                            @if ($schedule->requests()->exists())
                            <span class="notificacao"></span>
                            @endif
                        </div>
                    </a>
                    @else
                    <a href="{{ route('filament.admin.resources.schedules.create', [
                                    'weekday' => $dayId,
                                    'timeperiod' => $timePeriod->id,
                                ]) }}"
                        class="block p-2 text-gray-400 dark:text-gray-600 hover:text-blue-600 dark:hover:text-blue-400 transition">
                        +
                    </a>
                    @endif
                </td>
                @endforeach
            </tr>
            @endforeach
        </tbody>
    </table>
</div>